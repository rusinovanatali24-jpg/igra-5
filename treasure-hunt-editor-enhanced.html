<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px 40px; text-align: center; }
        .header h1 { font-size: 2.5em; margin-bottom: 10px; }
        .header p { font-size: 1.2em; opacity: 0.9; }
        .tabs { display: flex; background: #f5f5f5; border-bottom: 2px solid #ddd; }
        .tab { flex: 1; padding: 20px; text-align: center; cursor: pointer; font-size: 1.1em; font-weight: bold; transition: all 0.3s ease; border: none; background: transparent; color: #666; }
        .tab:hover { background: #e8e8e8; }
        .tab.active { background: white; color: #667eea; border-bottom: 3px solid #667eea; }
        .tab-content { padding: 40px; display: none; }
        .tab-content.active { display: block; }
        .section { margin-bottom: 40px; padding: 25px; background: #f9f9f9; border-radius: 10px; border-left: 4px solid #667eea; }
        .section-title { font-size: 1.5em; margin-bottom: 20px; color: #333; display: flex; align-items: center; gap: 10px; }
        .section-title::before { content: '‚ñ∏'; color: #667eea; font-weight: bold; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #333; }
        .form-group input[type="text"], .form-group input[type="number"], .form-group textarea, .form-group select { width: 100%; padding: 12px 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em; font-family: inherit; transition: border-color 0.3s ease; }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus { outline: none; border-color: #667eea; }
        .form-group textarea { resize: vertical; min-height: 100px; }
        .theme-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .theme-card { padding: 20px; border: 3px solid #ddd; border-radius: 12px; text-align: center; cursor: pointer; transition: all 0.3s ease; background: white; }
        .theme-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
        .theme-card.selected { border-color: #667eea; background: #f0f4ff; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); }
        .theme-icon { font-size: 4em; margin-bottom: 10px; }
        .theme-name { font-size: 1.2em; font-weight: bold; color: #333; }
        .questions-list { display: flex; flex-direction: column; gap: 20px; }
        .question-item { background: white; border: 2px solid #ddd; border-radius: 10px; padding: 20px; }
        .question-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .question-number { background: #667eea; color: white; padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .answer-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; padding: 10px; background: #f9f9f9; border-radius: 6px; }
        .answer-item input[type="text"] { flex: 1; }
        .answer-item input[type="checkbox"], .answer-item input[type="radio"] { width: 20px; height: 20px; cursor: pointer; }
        .answer-controls { display: flex; gap: 10px; margin-top: 10px; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—Ç—ã */
        .map-section { display: flex; flex-direction: column; gap: 20px; }
        .map-selector { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .map-option { border: 3px solid #ddd; border-radius: 10px; padding: 10px; cursor: pointer; text-align: center; transition: all 0.3s ease; background: white; }
        .map-option:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .map-option.selected { border-color: #667eea; background: #f0f4ff; }
        .map-option-icon { font-size: 3em; margin-bottom: 5px; }
        .map-option-name { font-weight: bold; color: #333; }
        
        .map-editor { position: relative; width: 100%; height: 600px; border: 4px solid #8b4513; border-radius: 15px; overflow: hidden; background-size: cover; background-position: center; }
        .map-editor.pirates { 
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.9) 0%, rgba(196, 154, 108, 0.9) 100%), 
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect fill="%23d4a574" width="800" height="600"/><circle cx="400" cy="300" r="150" fill="rgba(139,69,19,0.3)"/><circle cx="200" cy="150" r="80" fill="rgba(139,69,19,0.2)"/><circle cx="600" cy="450" r="100" fill="rgba(139,69,19,0.2)"/><path d="M50 500 Q150 480 250 500 T450 500" stroke="rgba(139,69,19,0.4)" stroke-width="3" fill="none"/></svg>');
            border-color: #8b4513;
        }
        .map-editor.space { 
            background: linear-gradient(135deg, rgba(15, 52, 96, 0.95) 0%, rgba(26, 26, 46, 0.95) 100%),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect fill="%230f3460" width="800" height="600"/><circle cx="100" cy="80" r="2" fill="white"/><circle cx="200" cy="120" r="1.5" fill="white"/><circle cx="350" cy="90" r="2" fill="white"/><circle cx="450" cy="150" r="1" fill="white"/><circle cx="550" cy="100" r="2.5" fill="white"/><circle cx="650" cy="130" r="1.5" fill="white"/><circle cx="400" cy="200" r="60" fill="rgba(0,212,255,0.2)"/></svg>');
            border-color: #00d4ff;
        }
        .map-editor.jungle { 
            background: linear-gradient(135deg, rgba(168, 213, 186, 0.9) 0%, rgba(124, 179, 66, 0.9) 100%),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect fill="%23a8d5ba" width="800" height="600"/><ellipse cx="150" cy="500" rx="80" ry="40" fill="rgba(45,80,22,0.3)"/><ellipse cx="400" cy="520" rx="120" ry="50" fill="rgba(45,80,22,0.3)"/><circle cx="200" cy="150" r="50" fill="rgba(45,80,22,0.25)"/><circle cx="500" cy="180" r="60" fill="rgba(45,80,22,0.25)"/></svg>');
            border-color: #2d5016;
        }
        .map-editor.underwater { 
            background: linear-gradient(135deg, rgba(179, 229, 252, 0.9) 0%, rgba(79, 195, 247, 0.9) 100%),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect fill="%23b3e5fc" width="800" height="600"/><path d="M0 450 Q100 430 200 450 T400 450 T600 450 T800 450" fill="rgba(0,105,148,0.15)"/><path d="M0 500 Q100 485 200 500 T400 500 T600 500 T800 500" fill="rgba(0,105,148,0.2)"/><circle cx="150" cy="350" r="3" fill="rgba(0,212,255,0.6)"/><circle cx="500" cy="380" r="3.5" fill="rgba(0,212,255,0.6)"/></svg>');
            border-color: #006994;
        }
        .map-editor.city { 
            background: linear-gradient(135deg, rgba(224, 224, 224, 0.95) 0%, rgba(189, 189, 189, 0.95) 100%),
                        url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600"><rect fill="%23e0e0e0" width="800" height="600"/><rect x="50" y="300" width="80" height="300" fill="rgba(66,66,66,0.3)"/><rect x="150" y="250" width="100" height="350" fill="rgba(66,66,66,0.35)"/><rect x="270" y="200" width="90" height="400" fill="rgba(66,66,66,0.3)"/><rect x="510" y="220" width="95" height="380" fill="rgba(66,66,66,0.3)"/></svg>');
            border-color: #424242;
        }
        .map-editor.custom {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }
        
        .map-point-editor { 
            position: absolute; 
            width: 40px; 
            height: 50px; 
            cursor: move; 
            transform: translate(-50%, -100%); 
            user-select: none;
            font-size: 40px;
            filter: drop-shadow(0 3px 6px rgba(0,0,0,0.4));
            transition: transform 0.2s ease;
        }
        .map-point-editor:hover { 
            transform: translate(-50%, -100%) scale(1.15);
        }
        .map-point-label {
            position: absolute;
            bottom: -5px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        .upload-area:hover {
            border-color: #667eea;
            background: #f9f9ff;
        }
        .upload-area input[type="file"] {
            display: none;
        }
        
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; font-weight: bold; cursor: pointer; transition: all 0.3s ease; font-family: inherit; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%); color: white; }
        .btn-success:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(86, 171, 47, 0.4); }
        .btn-danger { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; }
        .btn-danger:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(235, 51, 73, 0.4); }
        .btn-secondary { background: #f5f5f5; color: #333; border: 2px solid #ddd; }
        .btn-secondary:hover { background: #e8e8e8; }
        .btn-small { padding: 8px 20px; font-size: 0.9em; }
        .action-bar { display: flex; gap: 15px; justify-content: center; padding: 30px; background: #f5f5f5; border-top: 2px solid #ddd; }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        
        /* –ü—Ä–µ–≤—å—é —Å—Ç–∏–ª–∏ */
        .preview-info { background: #e8f4f8; border: 2px solid #4a90e2; border-radius: 10px; padding: 20px; margin-bottom: 20px; }
        .preview-info h3 { color: #4a90e2; margin-bottom: 10px; }
        .stat-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #d0e8f2; }
        .stat-row:last-child { border-bottom: none; }
        .stat-label { font-weight: 600; }
        .stat-value { color: #667eea; font-weight: bold; }
        
        .iframe-container {
            background: #f9f9f9;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
        }
        .iframe-code {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .copy-btn {
            margin-top: 10px;
        }
        
        @media (max-width: 768px) { 
            .settings-grid { grid-template-columns: 1fr; } 
            .theme-selector { grid-template-columns: 1fr; }
            .map-selector { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéÆ –†–µ–¥–∞–∫—Ç–æ—Ä –∏–≥—Ä—ã "–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏"</h1>
            <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—é —É–Ω–∏–∫–∞–ª—å–Ω—É—é –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—É—é –∏–≥—Ä—É</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">‚öôÔ∏è –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            <button class="tab" onclick="switchTab(1)">‚ùì –í–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(2)">üó∫Ô∏è –ö–∞—Ä—Ç–∞</button>
            <button class="tab" onclick="switchTab(3)">üëÅÔ∏è –ü—Ä–µ–≤—å—é</button>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 1: –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
        <div class="tab-content active">
            <div class="section">
                <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –∏–≥—Ä—ã</h2>
                <div class="theme-selector" id="themeSelector"></div>
            </div>
            <div class="section">
                <h2 class="section-title">–ò–≥—Ä–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label for="maxAttempts">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ –≤–æ–ø—Ä–æ—Å</label>
                        <select id="maxAttempts">
                            <option value="1">1 –ø–æ–ø—ã—Ç–∫–∞</option>
                            <option value="2">2 –ø–æ–ø—ã—Ç–∫–∏</option>
                            <option value="3" selected>3 –ø–æ–ø—ã—Ç–∫–∏</option>
                            <option value="999">–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="timerDuration">–¢–∞–π–º–µ—Ä –Ω–∞ –≤–æ–ø—Ä–æ—Å (—Å–µ–∫—É–Ω–¥—ã)</label>
                        <select id="timerDuration">
                            <option value="0">–ë–µ–∑ —Ç–∞–π–º–µ—Ä–∞</option>
                            <option value="15">15 —Å–µ–∫—É–Ω–¥</option>
                            <option value="30" selected>30 —Å–µ–∫—É–Ω–¥</option>
                            <option value="60">60 —Å–µ–∫—É–Ω–¥</option>
                            <option value="90">90 —Å–µ–∫—É–Ω–¥</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="pointsPerQuestion">–ë–∞–ª–ª–æ–≤ –∑–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</label>
                        <input type="number" id="pointsPerQuestion" value="10" min="1" max="100">
                    </div>
                    <div class="form-group">
                        <label for="hintsAvailable">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫ "50/50"</label>
                        <input type="number" id="hintsAvailable" value="2" min="0" max="10">
                    </div>
                    <div class="form-group">
                        <label><input type="checkbox" id="showCorrectAnswer" checked style="width: auto; margin-right: 10px;">–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ—Å–ª–µ –æ—à–∏–±–∫–∏</label>
                    </div>
                </div>
            </div>
            <div class="section">
                <h2 class="section-title">–§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞–≥—Ä–∞–¥–∞</h2>
                <div class="settings-grid">
                    <div class="form-group">
                        <label for="finalReward">–¢–∏–ø –Ω–∞–≥—Ä–∞–¥—ã</label>
                        <select id="finalReward">
                            <option value="treasure" selected>üè¥‚Äç‚ò†Ô∏è –°—É–Ω–¥—É–∫ —Å —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</option>
                            <option value="medal">üèÖ –ó–æ–ª–æ—Ç–∞—è –º–µ–¥–∞–ª—å</option>
                            <option value="trophy">üèÜ –ö—É–±–æ–∫ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è</option>
                            <option value="crystal">üíé –ú–∞–≥–∏—á–µ—Å–∫–∏–π –∫—Ä–∏—Å—Ç–∞–ª–ª</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="finalMessage">–ü–æ–∑–¥—Ä–∞–≤–∏—Ç–µ–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</label>
                        <input type="text" id="finalMessage" value="–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ –≤—Å–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞!">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 2: –í–æ–ø—Ä–æ—Å—ã -->
        <div class="tab-content">
            <div class="section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 class="section-title" style="margin: 0;">–°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤</h2>
                    <button class="btn btn-success" onclick="addQuestion()">+ –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                </div>
                <div class="questions-list" id="questionsList"></div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 3: –ö–∞—Ä—Ç–∞ -->
        <div class="tab-content">
            <div class="section">
                <h2 class="section-title">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ä—Ç—É</h2>
                <div class="map-selector" id="mapSelector"></div>
                
                <div class="upload-area" onclick="document.getElementById('customMapUpload').click()">
                    <input type="file" id="customMapUpload" accept="image/*" onchange="uploadCustomMap(event)">
                    <div style="font-size: 3em; margin-bottom: 10px;">üì§</div>
                    <div style="font-size: 1.2em; font-weight: bold; margin-bottom: 5px;">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É</div>
                    <div style="color: #666;">–ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞ (JPG, PNG)</div>
                </div>
            </div>
            
            <div class="section">
                <h2 class="section-title">–†–∞—Å—Å—Ç–∞–≤—å—Ç–µ —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ</h2>
                <p style="color: #666; margin-bottom: 20px;">–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –º–∞—Ä–∫–µ—Ä—ã –º—ã—à–∫–æ–π. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–∞—Ä–∫–µ—Ä–æ–≤ = –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≤–æ–ø—Ä–æ—Å–æ–≤.</p>
                <div class="map-editor pirates" id="mapEditor"></div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ 4: –ü—Ä–µ–≤—å—é -->
        <div class="tab-content">
            <div class="preview-info">
                <h3>üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤–∞—à–µ–π –∏–≥—Ä–µ</h3>
                <div class="stat-row"><span class="stat-label">–¢–µ–º–∞:</span><span class="stat-value" id="previewTheme">-</span></div>
                <div class="stat-row"><span class="stat-label">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤:</span><span class="stat-value" id="previewQuestions">-</span></div>
                <div class="stat-row"><span class="stat-label">–ü–æ–ø—ã—Ç–æ–∫ –Ω–∞ –≤–æ–ø—Ä–æ—Å:</span><span class="stat-value" id="previewAttempts">-</span></div>
                <div class="stat-row"><span class="stat-label">–¢–∞–π–º–µ—Ä:</span><span class="stat-value" id="previewTimer">-</span></div>
                <div class="stat-row"><span class="stat-label">–ë–∞–ª–ª–æ–≤ –∑–∞ –≤–æ–ø—Ä–æ—Å:</span><span class="stat-value" id="previewPoints">-</span></div>
                <div class="stat-row"><span class="stat-label">–ú–∞–∫—Å–∏–º—É–º –±–∞–ª–ª–æ–≤:</span><span class="stat-value" id="previewMaxPoints">-</span></div>
            </div>
            
            <div class="section">
                <h2 class="section-title">üéØ –≠–∫—Å–ø–æ—Ä—Ç –∏–≥—Ä—ã</h2>
                <p style="margin-bottom: 20px; font-size: 1.1em;">–°–∫–∞—á–∞–π—Ç–µ –∏–≥—Ä—É –∫–∞–∫ HTML —Ñ–∞–π–ª –∏–ª–∏ –ø–æ–ª—É—á–∏—Ç–µ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π –∫–æ–¥ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –≤ Genially</p>
                <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="exportGame()" style="font-size: 1.1em; padding: 15px 35px;">üíæ –°–∫–∞—á–∞—Ç—å HTML —Ñ–∞–π–ª</button>
                    <button class="btn btn-primary" onclick="exportStandaloneGame()" style="font-size: 1.1em; padding: 15px 35px;">üöÄ –°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞</button>
                </div>
                
                <div class="iframe-container">
                    <h3 style="margin-bottom: 15px;">üì± –ö–æ–¥ –¥–ª—è –≤—Å—Ç—Ä–∞–∏–≤–∞–Ω–∏—è –≤ Genially</h3>
                    <p style="color: #666; margin-bottom: 15px;">
                        <strong>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:</strong><br>
                        1. –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥"<br>
                        2. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–¥<br>
                        3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –∏–≥—Ä—ã –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitHub Pages)<br>
                        4. –ó–∞–º–µ–Ω–∏—Ç–µ URL –≤ –∫–æ–¥–µ –Ω–∞ –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ —Ñ–∞–π–ª–∞<br>
                        5. –í—Å—Ç–∞–≤—å—Ç–µ –∫–æ–¥ –≤ —ç–ª–µ–º–µ–Ω—Ç "HTML" –≤ Genially
                    </p>
                    <div class="iframe-code" id="iframeCode">&lt;!-- –ù–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥" --&gt;</div>
                    <button class="btn btn-primary copy-btn" onclick="copyIframeCode()">üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
                    <button class="btn btn-secondary copy-btn" onclick="updateIframeCode()">üîÑ –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥</button>
                </div>
            </div>
        </div>
        
        <div class="action-bar">
            <button class="btn btn-secondary" onclick="saveToLocalStorage()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ</button>
            <button class="btn btn-secondary" onclick="loadFromLocalStorage()">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ –±—Ä–∞—É–∑–µ—Ä–∞</button>
            <button class="btn btn-primary" onclick="switchTab(3)">üëÅÔ∏è –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–µ–≤—å—é</button>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script>
// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
var editorData = {
    theme: 'pirates',
    mapType: 'pirates',
    customMapUrl: null,
    maxAttempts: 3,
    timerDuration: 30,
    pointsPerQuestion: 10,
    hintsAvailable: 2,
    showCorrectAnswer: true,
    finalReward: 'treasure',
    finalMessage: '–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –Ω–∞—à–ª–∏ –≤—Å–µ —Å–æ–∫—Ä–æ–≤–∏—â–∞!',
    questions: [],
    mapPoints: []
};

var themes = [
    {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è', colors:{primary:'#8b4513', accent:'#ffd700', bg:'#f4e4c1'}},
    {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ', colors:{primary:'#1a1a2e', accent:'#00d4ff', bg:'#0f3460'}},
    {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥', colors:{primary:'#2d5016', accent:'#90EE90', bg:'#a8d5ba'}},
    {id:'underwater', name:'–ü–æ–¥–≤–æ–¥–Ω—ã–π –º–∏—Ä', icon:'üê†', colors:{primary:'#006994', accent:'#00d4ff', bg:'#b3e5fc'}},
    {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è', colors:{primary:'#424242', accent:'#ffeb3b', bg:'#e0e0e0'}}
];

var mapOptions = [
    {id:'pirates', name:'–ü–∏—Ä–∞—Ç—ã', icon:'üè¥‚Äç‚ò†Ô∏è'},
    {id:'space', name:'–ö–æ—Å–º–æ—Å', icon:'üöÄ'},
    {id:'jungle', name:'–î–∂—É–Ω–≥–ª–∏', icon:'üå¥'},
    {id:'underwater', name:'–ú–æ—Ä–µ', icon:'üê†'},
    {id:'city', name:'–ì–æ—Ä–æ–¥', icon:'üèôÔ∏è'}
];

var draggedPoint = null;
var offsetX = 0;
var offsetY = 0;

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
function switchTab(index) {
    var tabs = document.querySelectorAll('.tab');
    var contents = document.querySelectorAll('.tab-content');
    
    for (var i = 0; i < tabs.length; i++) {
        if (i === index) {
            tabs[i].classList.add('active');
            contents[i].classList.add('active');
        } else {
            tabs[i].classList.remove('active');
            contents[i].classList.remove('active');
        }
    }
    
    if (index === 3) {
        updatePreview();
    }
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç–µ–º
function renderThemes() {
    var container = document.getElementById('themeSelector');
    var html = '';
    for (var i = 0; i < themes.length; i++) {
        var theme = themes[i];
        var selected = theme.id === editorData.theme ? 'selected' : '';
        html += '<div class="theme-card ' + selected + '" onclick="selectTheme(\'' + theme.id + '\')">';
        html += '<div class="theme-icon">' + theme.icon + '</div>';
        html += '<div class="theme-name">' + theme.name + '</div>';
        html += '</div>';
    }
    container.innerHTML = html;
}

// –í—ã–±–æ—Ä —Ç–µ–º—ã
function selectTheme(themeId) {
    editorData.theme = themeId;
    renderThemes();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç
function renderMapSelector() {
    var container = document.getElementById('mapSelector');
    var html = '';
    for (var i = 0; i < mapOptions.length; i++) {
        var map = mapOptions[i];
        var selected = map.id === editorData.mapType ? 'selected' : '';
        html += '<div class="map-option ' + selected + '" onclick="selectMap(\'' + map.id + '\')">';
        html += '<div class="map-option-icon">' + map.icon + '</div>';
        html += '<div class="map-option-name">' + map.name + '</div>';
        html += '</div>';
    }
    container.innerHTML = html;
}

// –í—ã–±–æ—Ä –∫–∞—Ä—Ç—ã
function selectMap(mapId) {
    editorData.mapType = mapId;
    editorData.customMapUrl = null;
    renderMapSelector();
    updateMapTheme();
}

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å–≤–æ–µ–π –∫–∞—Ä—Ç—ã
function uploadCustomMap(event) {
    var file = event.target.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function(e) {
            editorData.customMapUrl = e.target.result;
            editorData.mapType = 'custom';
            renderMapSelector();
            updateMapTheme();
        };
        reader.readAsDataURL(file);
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–º—ã –∫–∞—Ä—Ç—ã
function updateMapTheme() {
    var mapEditor = document.getElementById('mapEditor');
    mapEditor.className = 'map-editor';
    
    if (editorData.mapType === 'custom' && editorData.customMapUrl) {
        mapEditor.classList.add('custom');
        mapEditor.style.backgroundImage = 'url(' + editorData.customMapUrl + ')';
    } else {
        mapEditor.classList.add(editorData.mapType);
        mapEditor.style.backgroundImage = '';
    }
}

// –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
function addQuestion() {
    var newQuestion = {
        id: Date.now(),
        text: '',
        type: 'single',
        answers: [
            {id: 1, text: '', correct: true},
            {id: 2, text: '', correct: false},
            {id: 3, text: '', correct: false},
            {id: 4, text: '', correct: false}
        ],
        correctAnswer: '',
        explanation: ''
    };
    editorData.questions.push(newQuestion);
    renderQuestions();
    updateMapPoints();
}

// –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
function deleteQuestion(questionId) {
    if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) {
        editorData.questions = editorData.questions.filter(function(q) {
            return q.id !== questionId;
        });
        renderQuestions();
        updateMapPoints();
    }
}

// –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞
function addAnswer(questionId) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            var maxId = 0;
            for (var j = 0; j < editorData.questions[i].answers.length; j++) {
                if (editorData.questions[i].answers[j].id > maxId) {
                    maxId = editorData.questions[i].answers[j].id;
                }
            }
            editorData.questions[i].answers.push({
                id: maxId + 1,
                text: '',
                correct: false
            });
            break;
        }
    }
    renderQuestions();
}

// –£–¥–∞–ª–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞
function deleteAnswer(questionId, answerId) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            if (editorData.questions[i].answers.length <= 2) {
                alert('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–∞!');
                return;
            }
            editorData.questions[i].answers = editorData.questions[i].answers.filter(function(a) {
                return a.id !== answerId;
            });
            break;
        }
    }
    renderQuestions();
}

// –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤
function renderQuestions() {
    var container = document.getElementById('questionsList');
    if (editorData.questions.length === 0) {
        container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤. –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å!</p>';
        return;
    }
    
    var html = '';
    for (var i = 0; i < editorData.questions.length; i++) {
        var q = editorData.questions[i];
        html += '<div class="question-item">';
        html += '<div class="question-header">';
        html += '<span class="question-number">–í–æ–ø—Ä–æ—Å ' + (i + 1) + '</span>';
        html += '<button class="btn btn-danger btn-small" onclick="deleteQuestion(' + q.id + ')">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>';
        html += '</div>';
        html += '<div class="form-group">';
        html += '<label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>';
        html += '<textarea onchange="updateQuestion(' + q.id + ',\'text\',this.value)" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞">' + q.text + '</textarea>';
        html += '</div>';
        html += '<div class="form-group">';
        html += '<label>–¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞</label>';
        html += '<select onchange="updateQuestionType(' + q.id + ',this.value)">';
        html += '<option value="single"' + (q.type === 'single' ? ' selected' : '') + '>–û–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</option>';
        html += '<option value="multiple"' + (q.type === 'multiple' ? ' selected' : '') + '>–ù–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤</option>';
        html += '<option value="text"' + (q.type === 'text' ? ' selected' : '') + '>–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥</option>';
        html += '</select>';
        html += '</div>';
        
        if (q.type === 'text') {
            html += '<div class="form-group">';
            html += '<label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç (—Ç–µ–∫—Å—Ç)</label>';
            html += '<input type="text" value="' + q.correctAnswer + '" onchange="updateQuestion(' + q.id + ',\'correctAnswer\',this.value)" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç">';
            html += '</div>';
        } else {
            html += '<div class="form-group">';
            html += '<label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ ' + (q.type === 'multiple' ? '(–æ—Ç–º–µ—Ç—å—Ç–µ –≤—Å–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ)' : '(–æ—Ç–º–µ—Ç—å—Ç–µ –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)') + '</label>';
            for (var j = 0; j < q.answers.length; j++) {
                var a = q.answers[j];
                html += '<div class="answer-item">';
                html += '<input type="' + (q.type === 'multiple' ? 'checkbox' : 'radio') + '" name="correct_' + q.id + '"' + (a.correct ? ' checked' : '') + ' onchange="updateAnswerCorrect(' + q.id + ',' + a.id + ',this.checked,\'' + q.type + '\')">';
                html += '<input type="text" value="' + a.text + '" onchange="updateAnswerText(' + q.id + ',' + a.id + ',this.value)" placeholder="–í–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞ ' + (j + 1) + '">';
                html += '<button class="btn btn-danger btn-small" onclick="deleteAnswer(' + q.id + ',' + a.id + ')">‚úï</button>';
                html += '</div>';
            }
            html += '<div class="answer-controls">';
            html += '<button class="btn btn-secondary btn-small" onclick="addAnswer(' + q.id + ')">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç</button>';
            html += '</div>';
            html += '</div>';
        }
        
        html += '<div class="form-group">';
        html += '<label>–û–±—ä—è—Å–Ω–µ–Ω–∏–µ (–ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–≤–µ—Ç–∞)</label>';
        html += '<textarea onchange="updateQuestion(' + q.id + ',\'explanation\',this.value)" placeholder="–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ">' + q.explanation + '</textarea>';
        html += '</div>';
        html += '</div>';
    }
    container.innerHTML = html;
}

// –û–±–Ω–æ–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
function updateQuestion(questionId, field, value) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            editorData.questions[i][field] = value;
            break;
        }
    }
}

// –ò–∑–º–µ–Ω–∏—Ç—å —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞
function updateQuestionType(questionId, newType) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            editorData.questions[i].type = newType;
            if (newType === 'single') {
                for (var j = 0; j < editorData.questions[i].answers.length; j++) {
                    editorData.questions[i].answers[j].correct = (j === 0);
                }
            }
            break;
        }
    }
    renderQuestions();
}

// –û–±–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞
function updateAnswerText(questionId, answerId, text) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            for (var j = 0; j < editorData.questions[i].answers.length; j++) {
                if (editorData.questions[i].answers[j].id === answerId) {
                    editorData.questions[i].answers[j].text = text;
                    break;
                }
            }
            break;
        }
    }
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞
function updateAnswerCorrect(questionId, answerId, isCorrect, type) {
    for (var i = 0; i < editorData.questions.length; i++) {
        if (editorData.questions[i].id === questionId) {
            if (type === 'single') {
                for (var j = 0; j < editorData.questions[i].answers.length; j++) {
                    editorData.questions[i].answers[j].correct = (editorData.questions[i].answers[j].id === answerId);
                }
            } else {
                for (var j = 0; j < editorData.questions[i].answers.length; j++) {
                    if (editorData.questions[i].answers[j].id === answerId) {
                        editorData.questions[i].answers[j].correct = isCorrect;
                        break;
                    }
                }
            }
            break;
        }
    }
    renderQuestions();
}

// –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ—á–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
function updateMapPoints() {
    var mapEditor = document.getElementById('mapEditor');
    var questionsCount = editorData.questions.length;
    
    while (editorData.mapPoints.length < questionsCount) {
        var index = editorData.mapPoints.length;
        editorData.mapPoints.push({
            id: index + 1,
            x: 20 + (index * 15) % 60,
            y: 20 + (index * 20) % 60
        });
    }
    
    editorData.mapPoints = editorData.mapPoints.slice(0, questionsCount);
    
    var html = '';
    for (var i = 0; i < editorData.mapPoints.length; i++) {
        var point = editorData.mapPoints[i];
        html += '<div class="map-point-editor" id="point_' + point.id + '" style="left:' + point.x + '%;top:' + point.y + '%;" onmousedown="startDrag(event,' + point.id + ')">';
        html += 'üìç';
        html += '<div class="map-point-label">' + point.id + '</div>';
        html += '</div>';
    }
    mapEditor.innerHTML = html;
}

// –ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏–µ —Ç–æ—á–µ–∫
function startDrag(event, pointId) {
    event.preventDefault();
    draggedPoint = pointId;
    var mapEditor = document.getElementById('mapEditor');
    var rect = mapEditor.getBoundingClientRect();
    
    for (var i = 0; i < editorData.mapPoints.length; i++) {
        if (editorData.mapPoints[i].id === pointId) {
            var point = editorData.mapPoints[i];
            offsetX = event.clientX - (rect.left + (point.x / 100) * rect.width);
            offsetY = event.clientY - (rect.top + (point.y / 100) * rect.height);
            break;
        }
    }
    
    document.addEventListener('mousemove', onDrag);
    document.addEventListener('mouseup', stopDrag);
}

function onDrag(event) {
    if (!draggedPoint) return;
    
    var mapEditor = document.getElementById('mapEditor');
    var rect = mapEditor.getBoundingClientRect();
    var x = ((event.clientX - offsetX - rect.left) / rect.width) * 100;
    var y = ((event.clientY - offsetY - rect.top) / rect.height) * 100;
    
    for (var i = 0; i < editorData.mapPoints.length; i++) {
        if (editorData.mapPoints[i].id === draggedPoint) {
            editorData.mapPoints[i].x = Math.max(5, Math.min(95, x));
            editorData.mapPoints[i].y = Math.max(10, Math.min(90, y));
            
            var pointEl = document.getElementById('point_' + draggedPoint);
            if (pointEl) {
                pointEl.style.left = editorData.mapPoints[i].x + '%';
                pointEl.style.top = editorData.mapPoints[i].y + '%';
            }
            break;
        }
    }
}

function stopDrag() {
    draggedPoint = null;
    document.removeEventListener('mousemove', onDrag);
    document.removeEventListener('mouseup', stopDrag);
}

// –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é
function updatePreview() {
    var theme = null;
    for (var i = 0; i < themes.length; i++) {
        if (themes[i].id === editorData.theme) {
            theme = themes[i];
            break;
        }
    }
    
    var timerText = editorData.timerDuration > 0 ? editorData.timerDuration + ' —Å–µ–∫—É–Ω–¥' : '–ë–µ–∑ —Ç–∞–π–º–µ—Ä–∞';
    var attemptsText = editorData.maxAttempts === 999 ? '–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ' : editorData.maxAttempts;
    
    document.getElementById('previewTheme').textContent = theme.name + ' ' + theme.icon;
    document.getElementById('previewQuestions').textContent = editorData.questions.length;
    document.getElementById('previewAttempts').textContent = attemptsText;
    document.getElementById('previewTimer').textContent = timerText;
    document.getElementById('previewPoints').textContent = editorData.pointsPerQuestion;
    document.getElementById('previewMaxPoints').textContent = editorData.questions.length * editorData.pointsPerQuestion;
}

// –°–æ–±—Ä–∞—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
function collectSettings() {
    editorData.maxAttempts = parseInt(document.getElementById('maxAttempts').value);
    editorData.timerDuration = parseInt(document.getElementById('timerDuration').value);
    editorData.pointsPerQuestion = parseInt(document.getElementById('pointsPerQuestion').value);
    editorData.hintsAvailable = parseInt(document.getElementById('hintsAvailable').value);
    editorData.showCorrectAnswer = document.getElementById('showCorrectAnswer').checked;
    editorData.finalReward = document.getElementById('finalReward').value;
    editorData.finalMessage = document.getElementById('finalMessage').value;
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage
function saveToLocalStorage() {
    collectSettings();
    localStorage.setItem('treasureHuntEditor', JSON.stringify(editorData));
    alert('‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –±—Ä–∞—É–∑–µ—Ä–µ!');
}

// –ó–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
function loadFromLocalStorage() {
    var saved = localStorage.getItem('treasureHuntEditor');
    if (saved) {
        editorData = JSON.parse(saved);
        document.getElementById('maxAttempts').value = editorData.maxAttempts;
        document.getElementById('timerDuration').value = editorData.timerDuration;
        document.getElementById('pointsPerQuestion').value = editorData.pointsPerQuestion;
        document.getElementById('hintsAvailable').value = editorData.hintsAvailable;
        document.getElementById('showCorrectAnswer').checked = editorData.showCorrectAnswer;
        document.getElementById('finalReward').value = editorData.finalReward;
        document.getElementById('finalMessage').value = editorData.finalMessage;
        renderThemes();
        renderMapSelector();
        renderQuestions();
        updateMapPoints();
        updateMapTheme();
        alert('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã!');
    } else {
        alert('‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö');
    }
}

// –≠–∫—Å–ø–æ—Ä—Ç –∏–≥—Ä—ã
function exportGame() {
    collectSettings();
    
    if (editorData.questions.length === 0) {
        alert('‚ùå –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å!');
        return;
    }
    
    for (var i = 0; i < editorData.questions.length; i++) {
        var q = editorData.questions[i];
        if (!q.text.trim()) {
            alert('‚ùå –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ç–µ–∫—Å—Ç!');
            return;
        }
        if (q.type === 'text' && !q.correctAnswer.trim()) {
            alert('‚ùå –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!');
            return;
        }
        if (q.type !== 'text') {
            var hasCorrect = false;
            var allFilled = true;
            for (var j = 0; j < q.answers.length; j++) {
                if (q.answers[j].correct) hasCorrect = true;
                if (!q.answers[j].text.trim()) allFilled = false;
            }
            if (!hasCorrect) {
                alert('‚ùå –í –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!');
                return;
            }
            if (!allFilled) {
                alert('‚ùå –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!');
                return;
            }
        }
    }
    
    var gameHTML = generateGameHTML();
    var blob = new Blob([gameHTML], {type: 'text/html;charset=utf-8'});
    saveAs(blob, 'treasure-hunt-game.html');
    alert('‚úÖ –ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞!');
}

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –∏–≥—Ä—ã (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è)
function generateGameHTML() {
    var theme = null;
    for (var i = 0; i < themes.length; i++) {
        if (themes[i].id === editorData.theme) {
            theme = themes[i];
            break;
        }
    }
    
    var html = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</title></head><body>';
    html += '<h1>–ò–≥—Ä–∞: –û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</h1>';
    html += '<p>–¢–µ–º–∞: ' + theme.name + ' ' + theme.icon + '</p>';
    html += '<p>–í–æ–ø—Ä–æ—Å–æ–≤: ' + editorData.questions.length + '</p>';
    html += '<p>–ò–≥—Ä–∞ —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞!</p>';
    html += '</body></html>';
    
    return html;
}

// –≠–∫—Å–ø–æ—Ä—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–≥—Ä—ã –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞
function exportStandaloneGame() {
    collectSettings();
    
    if (editorData.questions.length === 0) {
        alert('‚ùå –î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å!');
        return;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö (—Ç–∞ –∂–µ —á—Ç–æ –≤ exportGame)
    for (var i = 0; i < editorData.questions.length; i++) {
        var q = editorData.questions[i];
        if (!q.text.trim()) {
            alert('‚ùå –í—Å–µ –≤–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ç–µ–∫—Å—Ç!');
            return;
        }
        if (q.type === 'text' && !q.correctAnswer.trim()) {
            alert('‚ùå –î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!');
            return;
        }
        if (q.type !== 'text') {
            var hasCorrect = false;
            var allFilled = true;
            for (var j = 0; j < q.answers.length; j++) {
                if (q.answers[j].correct) hasCorrect = true;
                if (!q.answers[j].text.trim()) allFilled = false;
            }
            if (!hasCorrect) {
                alert('‚ùå –í –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!');
                return;
            }
            if (!allFilled) {
                alert('‚ùå –í—Å–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω—ã!');
                return;
            }
        }
    }
    
    var theme = null;
    for (var i = 0; i < themes.length; i++) {
        if (themes[i].id === editorData.theme) {
            theme = themes[i];
            break;
        }
    }
    
    // –°–æ–∑–¥–∞–µ–º –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π HTML —Ñ–∞–π–ª –∏–≥—Ä—ã
    var gameHTML = '<!DOCTYPE html>\n';
    gameHTML += '<html lang="ru">\n';
    gameHTML += '<head>\n';
    gameHTML += '    <meta charset="UTF-8">\n';
    gameHTML += '    <meta name="viewport" content="width=device-width, initial-scale=1.0">\n';
    gameHTML += '    <title>–û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏ - ' + theme.name + '</title>\n';
    gameHTML += '    <style>\n';
    gameHTML += '        body { margin: 0; padding: 20px; font-family: Arial, sans-serif; background: linear-gradient(135deg, ' + theme.colors.primary + ', ' + theme.colors.bg + '); min-height: 100vh; display: flex; align-items: center; justify-content: center; }\n';
    gameHTML += '        .game-container { max-width: 800px; width: 100%; background: white; border-radius: 20px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); }\n';
    gameHTML += '        h1 { text-align: center; color: ' + theme.colors.primary + '; margin-bottom: 30px; font-size: 2.5em; }\n';
    gameHTML += '        .info { text-align: center; font-size: 1.2em; color: #666; margin-bottom: 20px; }\n';
    gameHTML += '        .start-btn { display: block; margin: 30px auto; padding: 20px 60px; font-size: 1.5em; background: ' + theme.colors.primary + '; color: white; border: none; border-radius: 15px; cursor: pointer; transition: transform 0.3s ease; }\n';
    gameHTML += '        .start-btn:hover { transform: scale(1.05); }\n';
    gameHTML += '    </style>\n';
    gameHTML += '</head>\n';
    gameHTML += '<body>\n';
    gameHTML += '    <div class="game-container">\n';
    gameHTML += '        <h1>' + theme.icon + ' –û—Ö–æ—Ç–∞ –∑–∞ —Å–æ–∫—Ä–æ–≤–∏—â–∞–º–∏</h1>\n';
    gameHTML += '        <div class="info">\n';
    gameHTML += '            <p><strong>–¢–µ–º–∞:</strong> ' + theme.name + '</p>\n';
    gameHTML += '            <p><strong>–í–æ–ø—Ä–æ—Å–æ–≤:</strong> ' + editorData.questions.length + '</p>\n';
    gameHTML += '            <p><strong>–ë–∞–ª–ª–æ–≤ –∑–∞ –≤–æ–ø—Ä–æ—Å:</strong> ' + editorData.pointsPerQuestion + '</p>\n';
    gameHTML += '        </div>\n';
    gameHTML += '        <button class="start-btn" onclick="startGame()">üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>\n';
    gameHTML += '    </div>\n';
    gameHTML += '    <script>\n';
    gameHTML += '        var gameData = ' + JSON.stringify(editorData) + ';\n';
    gameHTML += '        function startGame() {\n';
    gameHTML += '            alert("–ò–≥—Ä–∞ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è! –í–æ–ø—Ä–æ—Å–æ–≤: " + gameData.questions.length);\n';
    gameHTML += '            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ –∏–≥—Ä—ã\n';
    gameHTML += '        }\n';
    gameHTML += '    </script>\n';
    gameHTML += '</body>\n';
    gameHTML += '</html>';
    
    var blob = new Blob([gameHTML], {type: 'text/html;charset=utf-8'});
    saveAs(blob, 'treasure-hunt-standalone.html');
    alert('‚úÖ –ò–≥—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞!\n\n–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª "treasure-hunt-standalone.html" –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥ (GitHub Pages, Netlify –∏ —Ç.–¥.) –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ URL –≤ iframe –∫–æ–¥–µ.');
}

// –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ iframe
function updateIframeCode() {
    collectSettings();
    
    if (editorData.questions.length === 0) {
        alert('‚ùå –°–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!');
        return;
    }
    
    // –ü—Ä–æ—Å—Ç–æ–π –∏ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π iframe –∫–æ–¥
    var iframeCode = '<iframe src="–í–ê–®_URL_–ò–ì–†–´_–ó–î–ï–°–¨" width="100%" height="600" frameborder="0" allowfullscreen></iframe>';
    
    document.getElementById('iframeCode').textContent = iframeCode;
    
    alert('‚úÖ –ö–æ–¥ —Å–æ–∑–¥–∞–Ω!\n\n1. –°–Ω–∞—á–∞–ª–∞ –Ω–∞–∂–º–∏—Ç–µ "–°–æ–∑–¥–∞—Ç—å –∏–≥—Ä—É –¥–ª—è —Ö–æ—Å—Ç–∏–Ω–≥–∞"\n2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª –Ω–∞ —Ö–æ—Å—Ç–∏–Ω–≥\n3. –ó–∞–º–µ–Ω–∏—Ç–µ –í–ê–®_URL_–ò–ì–†–´_–ó–î–ï–°–¨ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π URL\n4. –í—Å—Ç–∞–≤—å—Ç–µ –≤ Genially');
}

// –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ iframe
function copyIframeCode() {
    var code = document.getElementById('iframeCode').textContent;
    if (code.includes('–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ')) {
        alert('‚ùå –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–π—Ç–µ –∏–≥—Ä—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥"');
        return;
    }
    
    navigator.clipboard.writeText(code).then(function() {
        alert('‚úÖ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!');
    }).catch(function() {
        alert('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é.');
    });
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
function init() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ª–∏ –∏–≥—Ä–∞ —á–µ—Ä–µ–∑ iframe
    var urlParams = new URLSearchParams(window.location.search);
    var playGameId = urlParams.get('play');
    
    if (playGameId) {
        // –†–µ–∂–∏–º –∏–≥—Ä—ã - —Å–∫—Ä—ã–≤–∞–µ–º —Ä–µ–¥–∞–∫—Ç–æ—Ä –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–≥—Ä—É
        var gameData = localStorage.getItem(playGameId);
        if (gameData) {
            document.body.innerHTML = '<div style="padding: 40px; text-align: center;"><h1>üéÆ –ò–≥—Ä–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!</h1><p>–ò–≥—Ä–∞ —Å ID: ' + playGameId + '</p><p>–í–æ–ø—Ä–æ—Å–æ–≤: ' + JSON.parse(gameData).questions.length + '</p></div>';
            // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –∫–æ–¥ —Å–∞–º–æ–π –∏–≥—Ä—ã
        } else {
            document.body.innerHTML = '<div style="padding: 40px; text-align: center;"><h1>‚ùå –ò–≥—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞</h1><p>ID: ' + playGameId + '</p></div>';
        }
        return;
    }
    
    // –û–±—ã—á–Ω—ã–π —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
    renderThemes();
    renderMapSelector();
    addQuestion();
    updateMapPoints();
    
    var saved = localStorage.getItem('treasureHuntEditor');
    if (saved) {
        try {
            editorData = JSON.parse(saved);
            document.getElementById('maxAttempts').value = editorData.maxAttempts;
            document.getElementById('timerDuration').value = editorData.timerDuration;
            document.getElementById('pointsPerQuestion').value = editorData.pointsPerQuestion;
            document.getElementById('hintsAvailable').value = editorData.hintsAvailable;
            document.getElementById('showCorrectAnswer').checked = editorData.showCorrectAnswer;
            document.getElementById('finalReward').value = editorData.finalReward;
            document.getElementById('finalMessage').value = editorData.finalMessage;
            renderThemes();
            renderMapSelector();
            renderQuestions();
            updateMapPoints();
            updateMapTheme();
        } catch(e) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏:', e);
        }
    }
}

document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
